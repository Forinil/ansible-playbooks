---
- name: Provision Pi-hole server
  hosts: '{{ target | default([]) }}'
  # become: yes
  # become_method: sudo
  remote_user: root
  vars_files:
    - vars/pihole-config.yml
  tasks:
    - name: Apply system settings
      ansible.builtin.import_tasks:
        file: tasks/system-settings.yml
    - name: Create users and groups
      ansible.builtin.import_tasks:
        file: tasks/users-and-groups.yml
    - name: Install and configure Cloudflare DNS proxy
      ansible.builtin.import_tasks:
        file: tasks/configure-cloudflared-dns-proxy.yml
    - name: Install and configure Tailscale
      ansible.builtin.import_tasks:
        file: tasks/configure-tailscale.yml
    - name: Install and configure Pi-hole
      ansible.builtin.import_tasks:
        file: tasks/configure-pihole.yml
